<?xml version="1.0" encoding="UTF-8"?>
<!--
/**
 * 
 * Apoyar
 *
 * DISCLAIMER
 *
 * Please do not edit or add to this file if you wish to upgrade this extension to newer
 * version in the future.
 * 
 * @category   Apoyar
 * @package    Apoyar_ProductRules
 * @copyright  Copyright (c) 2023 Apoyar (http://www.apoyar.eu/)
 */
-->
<schema xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:framework:Setup/Declaration/Schema/etc/schema.xsd">
   <table name="apoyar_productrules" resource="default" engine="innodb" comment="apoyar productrules table">
      <column xsi:type="int" name="rule_id" unsigned="true" nullable="false" identity="true" comment="Rule Id" />
      <column xsi:type="varchar" name="name" length="255" comment="Name" />
      <column xsi:type="text" name="description" comment="Description" />
      <column xsi:type="text" name="categories" nullable="true" comment="Categories" />
      <column xsi:type="text" name="unassociate_categories" nullable="true" comment="Remove Categories" />
      <column xsi:type="date" name="from_date" nullable="true" comment="From date" />
      <column xsi:type="date" name="to_date" nullable="true" comment="To date" />
      <column xsi:type="smallint" name="is_active" nullable="false" default="0" comment="Is Active" />
      <column xsi:type="int" name="cronjob_slot" nullable="false" default="1" comment="Cron job slot" />
      <column xsi:type="text" name="conditions_serialized" nullable="true" comment="Conditions Serialized" />
      <column xsi:type="text" name="rules" nullable="true" comment="rules" />
      <column xsi:type="int" name="sort_order" unsigned="true" nullable="false" default="0" comment="Sort Order (Priority)" />
      <column xsi:type="timestamp" name="created_on" nullable="false" on_update="false" default="CURRENT_TIMESTAMP" comment="Created At" />
      <column xsi:type="timestamp" name="updated_on" nullable="false" on_update="true" default="CURRENT_TIMESTAMP" comment="Updated At" />
      <column xsi:type="varchar" name="is_dry_run" nullable="true" comment="is dry run" />
      <column xsi:type="varchar" name="product_types" nullable="true" comment="product types" />
      <column xsi:type="varchar" name="log_file" nullable="true" comment="log file" />
      <column xsi:type="varchar" name="apply_to_stores" nullable="true" comment="apply to stores" />
      <column xsi:type="decimal" name="lastrun_duration" scale="2" precision="2" nullable="true" comment="lastrun_duration" />
      <column xsi:type="int" name="lastrun_matches" comment="lastrun_matches" />
      <column xsi:type="int" name="lastrun_updates" comment="lastrun_updates" />
      <column xsi:type="text" name="download_log_file" nullable="true" comment="Download Log File" />
      <constraint xsi:type="primary" referenceId="PRIMARY">
         <column name="rule_id" />
      </constraint>
      <index referenceId="APOYAR_PRODUCTRULES_SORT_ORDER_IS_ACTIVE_TO_DATE_FROM_DATE" indexType="btree">
         <column name="sort_order"/>
         <column name="is_active"/>
         <column name="to_date"/>
         <column name="from_date"/>
      </index>
   </table>
</schema>
